<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>axios æ˜¯å¦‚ä½•å°è£… HTTP è¯·æ±‚çš„ | duangdongçš„note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="å‰ç«¯ç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="qd-blog,node,vuepress,leetcode,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.a427ee9b.css" as="style"><link rel="preload" href="/assets/js/app.6df8e219.js" as="script"><link rel="preload" href="/assets/js/2.e21ead49.js" as="script"><link rel="preload" href="/assets/js/19.553ed8c2.js" as="script"><link rel="prefetch" href="/assets/js/10.e0bdad61.js"><link rel="prefetch" href="/assets/js/100.82a4c820.js"><link rel="prefetch" href="/assets/js/101.f5d94e3b.js"><link rel="prefetch" href="/assets/js/102.7f36fa51.js"><link rel="prefetch" href="/assets/js/103.085df24a.js"><link rel="prefetch" href="/assets/js/104.76789169.js"><link rel="prefetch" href="/assets/js/105.9efb3db9.js"><link rel="prefetch" href="/assets/js/106.22337f5b.js"><link rel="prefetch" href="/assets/js/107.ac8e17b4.js"><link rel="prefetch" href="/assets/js/108.5fe47bcc.js"><link rel="prefetch" href="/assets/js/109.cf88a409.js"><link rel="prefetch" href="/assets/js/11.e801cea9.js"><link rel="prefetch" href="/assets/js/110.603c3bd4.js"><link rel="prefetch" href="/assets/js/111.26f89c7d.js"><link rel="prefetch" href="/assets/js/112.1ad5bc54.js"><link rel="prefetch" href="/assets/js/113.cde31a40.js"><link rel="prefetch" href="/assets/js/114.a1a2a895.js"><link rel="prefetch" href="/assets/js/115.31c25d8b.js"><link rel="prefetch" href="/assets/js/116.8ed4b493.js"><link rel="prefetch" href="/assets/js/117.c802c1ce.js"><link rel="prefetch" href="/assets/js/118.15aead28.js"><link rel="prefetch" href="/assets/js/119.c26b6aad.js"><link rel="prefetch" href="/assets/js/12.9ed8f981.js"><link rel="prefetch" href="/assets/js/120.c3410f53.js"><link rel="prefetch" href="/assets/js/121.357fc3f4.js"><link rel="prefetch" href="/assets/js/122.6ecee0a8.js"><link rel="prefetch" href="/assets/js/123.6b38e86a.js"><link rel="prefetch" href="/assets/js/124.463231bb.js"><link rel="prefetch" href="/assets/js/125.dc9f9675.js"><link rel="prefetch" href="/assets/js/126.97f340de.js"><link rel="prefetch" href="/assets/js/127.080209f1.js"><link rel="prefetch" href="/assets/js/128.dd7fed27.js"><link rel="prefetch" href="/assets/js/129.e9a49c7b.js"><link rel="prefetch" href="/assets/js/13.fb60e043.js"><link rel="prefetch" href="/assets/js/130.86b31ea7.js"><link rel="prefetch" href="/assets/js/131.be4dca8f.js"><link rel="prefetch" href="/assets/js/132.a4e032bd.js"><link rel="prefetch" href="/assets/js/133.545d53fa.js"><link rel="prefetch" href="/assets/js/134.ef4512f0.js"><link rel="prefetch" href="/assets/js/135.b15ec030.js"><link rel="prefetch" href="/assets/js/136.14e63782.js"><link rel="prefetch" href="/assets/js/137.671e87f8.js"><link rel="prefetch" href="/assets/js/138.b3d28a52.js"><link rel="prefetch" href="/assets/js/139.bc5e381c.js"><link rel="prefetch" href="/assets/js/14.63057fe7.js"><link rel="prefetch" href="/assets/js/140.ce3a69fc.js"><link rel="prefetch" href="/assets/js/141.09737b5b.js"><link rel="prefetch" href="/assets/js/142.49e3bb24.js"><link rel="prefetch" href="/assets/js/143.45031fa6.js"><link rel="prefetch" href="/assets/js/144.458e287e.js"><link rel="prefetch" href="/assets/js/145.9d21ff24.js"><link rel="prefetch" href="/assets/js/146.88d47473.js"><link rel="prefetch" href="/assets/js/147.277b5759.js"><link rel="prefetch" href="/assets/js/148.0dd5c138.js"><link rel="prefetch" href="/assets/js/149.d638ab21.js"><link rel="prefetch" href="/assets/js/15.3ac2cfb4.js"><link rel="prefetch" href="/assets/js/150.834eb5ca.js"><link rel="prefetch" href="/assets/js/151.0b833f48.js"><link rel="prefetch" href="/assets/js/152.d212207c.js"><link rel="prefetch" href="/assets/js/153.e8b1311a.js"><link rel="prefetch" href="/assets/js/154.74eb8531.js"><link rel="prefetch" href="/assets/js/16.f2129a31.js"><link rel="prefetch" href="/assets/js/17.27a38c73.js"><link rel="prefetch" href="/assets/js/18.ec5b4213.js"><link rel="prefetch" href="/assets/js/20.c1bf3bbb.js"><link rel="prefetch" href="/assets/js/21.5790bc21.js"><link rel="prefetch" href="/assets/js/22.29894e1b.js"><link rel="prefetch" href="/assets/js/23.bae1a497.js"><link rel="prefetch" href="/assets/js/24.1edc62bc.js"><link rel="prefetch" href="/assets/js/25.69b254ca.js"><link rel="prefetch" href="/assets/js/26.df57f236.js"><link rel="prefetch" href="/assets/js/27.9ae48125.js"><link rel="prefetch" href="/assets/js/28.d42d4bb6.js"><link rel="prefetch" href="/assets/js/29.f3630e2f.js"><link rel="prefetch" href="/assets/js/3.5c47a171.js"><link rel="prefetch" href="/assets/js/30.40cf5507.js"><link rel="prefetch" href="/assets/js/31.99b2787c.js"><link rel="prefetch" href="/assets/js/32.eef578d9.js"><link rel="prefetch" href="/assets/js/33.6755a6d2.js"><link rel="prefetch" href="/assets/js/34.add65d5c.js"><link rel="prefetch" href="/assets/js/35.3e4a0da9.js"><link rel="prefetch" href="/assets/js/36.9d4bd3f9.js"><link rel="prefetch" href="/assets/js/37.98506fd6.js"><link rel="prefetch" href="/assets/js/38.44bce283.js"><link rel="prefetch" href="/assets/js/39.62bf281f.js"><link rel="prefetch" href="/assets/js/4.8f6f0475.js"><link rel="prefetch" href="/assets/js/40.3a389edd.js"><link rel="prefetch" href="/assets/js/41.a309beb7.js"><link rel="prefetch" href="/assets/js/42.4e87216c.js"><link rel="prefetch" href="/assets/js/43.c6f6922b.js"><link rel="prefetch" href="/assets/js/44.fda8b3de.js"><link rel="prefetch" href="/assets/js/45.5a1c5b3b.js"><link rel="prefetch" href="/assets/js/46.289cbb81.js"><link rel="prefetch" href="/assets/js/47.81850ce8.js"><link rel="prefetch" href="/assets/js/48.e986629d.js"><link rel="prefetch" href="/assets/js/49.d04a41c3.js"><link rel="prefetch" href="/assets/js/5.8b87f02a.js"><link rel="prefetch" href="/assets/js/50.727fb121.js"><link rel="prefetch" href="/assets/js/51.a10ac8b0.js"><link rel="prefetch" href="/assets/js/52.4fffa0ef.js"><link rel="prefetch" href="/assets/js/53.03ab34e0.js"><link rel="prefetch" href="/assets/js/54.f05ee208.js"><link rel="prefetch" href="/assets/js/55.f90df177.js"><link rel="prefetch" href="/assets/js/56.86a4d03e.js"><link rel="prefetch" href="/assets/js/57.c8cee71c.js"><link rel="prefetch" href="/assets/js/58.0b503f53.js"><link rel="prefetch" href="/assets/js/59.c4daebc4.js"><link rel="prefetch" href="/assets/js/6.2f86309f.js"><link rel="prefetch" href="/assets/js/60.b9584ba1.js"><link rel="prefetch" href="/assets/js/61.fa6e5de3.js"><link rel="prefetch" href="/assets/js/62.4f67908f.js"><link rel="prefetch" href="/assets/js/63.0c9d8ccc.js"><link rel="prefetch" href="/assets/js/64.2754e515.js"><link rel="prefetch" href="/assets/js/65.f2bd6dd5.js"><link rel="prefetch" href="/assets/js/66.299c952c.js"><link rel="prefetch" href="/assets/js/67.2ccaf3ef.js"><link rel="prefetch" href="/assets/js/68.b6e197f0.js"><link rel="prefetch" href="/assets/js/69.b821ea5d.js"><link rel="prefetch" href="/assets/js/7.f1cc41de.js"><link rel="prefetch" href="/assets/js/70.7beae76c.js"><link rel="prefetch" href="/assets/js/71.d452a791.js"><link rel="prefetch" href="/assets/js/72.f3fd5168.js"><link rel="prefetch" href="/assets/js/73.0804c5f0.js"><link rel="prefetch" href="/assets/js/74.cdcdfbcc.js"><link rel="prefetch" href="/assets/js/75.e8e01c97.js"><link rel="prefetch" href="/assets/js/76.6801837d.js"><link rel="prefetch" href="/assets/js/77.04408d97.js"><link rel="prefetch" href="/assets/js/78.9130c8b3.js"><link rel="prefetch" href="/assets/js/79.dcf60589.js"><link rel="prefetch" href="/assets/js/8.89fa1943.js"><link rel="prefetch" href="/assets/js/80.efe0c1a1.js"><link rel="prefetch" href="/assets/js/81.8220fef3.js"><link rel="prefetch" href="/assets/js/82.ae2099d2.js"><link rel="prefetch" href="/assets/js/83.c563f161.js"><link rel="prefetch" href="/assets/js/84.e365194b.js"><link rel="prefetch" href="/assets/js/85.15de0cdb.js"><link rel="prefetch" href="/assets/js/86.b99959c5.js"><link rel="prefetch" href="/assets/js/87.6fccf3fc.js"><link rel="prefetch" href="/assets/js/88.9bc0613a.js"><link rel="prefetch" href="/assets/js/89.89530022.js"><link rel="prefetch" href="/assets/js/9.7637f327.js"><link rel="prefetch" href="/assets/js/90.53d12303.js"><link rel="prefetch" href="/assets/js/91.c55896d7.js"><link rel="prefetch" href="/assets/js/92.0fe1f724.js"><link rel="prefetch" href="/assets/js/93.d681c01d.js"><link rel="prefetch" href="/assets/js/94.ed89d267.js"><link rel="prefetch" href="/assets/js/95.96e675de.js"><link rel="prefetch" href="/assets/js/96.5ad7361e.js"><link rel="prefetch" href="/assets/js/97.e7f32727.js"><link rel="prefetch" href="/assets/js/98.c3a03e67.js"><link rel="prefetch" href="/assets/js/99.31f54446.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a427ee9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/principle/" class="nav-link">
  JSæ‰§è¡Œ
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  JSè®¾è®¡æ¨¡å¼
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  JSè¿›é˜¶
</a></div><div class="nav-item"><a href="/advanced-function/" class="nav-link">
  é«˜é˜¶å‡½æ•°
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/eight-essay/" class="nav-link">
  å…«è‚¡æ–‡
</a></div><div class="nav-item"><a href="/hand-writing/" class="nav-link">
  æ‰‹å†™å®ç°
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  å·¥å…·æ–¹æ³•
</a></div><div class="nav-item"><a href="https://link.qdzhou.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/principle/" class="nav-link">
  JSæ‰§è¡Œ
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  JSè®¾è®¡æ¨¡å¼
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  JSè¿›é˜¶
</a></div><div class="nav-item"><a href="/advanced-function/" class="nav-link">
  é«˜é˜¶å‡½æ•°
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/eight-essay/" class="nav-link">
  å…«è‚¡æ–‡
</a></div><div class="nav-item"><a href="/hand-writing/" class="nav-link">
  æ‰‹å†™å®ç°
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  å·¥å…·æ–¹æ³•
</a></div><div class="nav-item"><a href="https://link.qdzhou.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/advanced/" aria-current="page" class="sidebar-link">js è¿›é˜¶</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2-åŠ¨ç”»</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3-é«˜çº§api</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced/3-é«˜çº§api/JSB åŸç†ä¸å®è·µ.html" class="sidebar-link">JSB åŸç†ä¸å®è·µ</a></li><li><a href="/advanced/3-é«˜çº§api/axiosæ˜¯å¦‚ä½•å°è£…HTTPè¯·æ±‚çš„.html" class="active sidebar-link">axios æ˜¯å¦‚ä½•å°è£… HTTP è¯·æ±‚çš„</a></li><li><a href="/advanced/3-é«˜çº§api/mutation-observer.html" class="sidebar-link">DOM å˜åŠ¨è§‚å¯Ÿå™¨ï¼ˆMutation observerï¼‰</a></li><li><a href="/advanced/3-é«˜çº§api/ã€ŠYou-Dont-Know-JSã€‹ç¬”è®°å°è®¡.html" class="sidebar-link">ã€ŠYou-Dont-Know-JSã€‹ç¬”è®°å°è®¡</a></li><li><a href="/advanced/3-é«˜çº§api/å‰ç«¯é‰´æƒ.html" class="sidebar-link">å‰ç«¯é‰´æƒå¿…é¡»äº†è§£çš„5ä¸ªå…„å¼Ÿï¼šcookieã€sessionã€tokenã€jwtã€å•ç‚¹ç™»å½•</a></li><li><a href="/advanced/3-é«˜çº§api/å‘å¸ƒè®¢é˜…æ¨¡å¼.html" class="sidebar-link">JavaScriptçš„å‘å¸ƒè®¢é˜…æ¨¡å¼</a></li><li><a href="/advanced/3-é«˜çº§api/å›¾è§£JavaScriptç»§æ‰¿.html" class="sidebar-link">å›¾è§£ JavaScript ç»§æ‰¿ï¼Œä¸€æ–‡æå®šç»§æ‰¿ç›¸å…³çŸ¥è¯†</a></li><li><a href="/advanced/3-é«˜çº§api/åŸºäºjsç®¡ç†å¤§æ–‡ä»¶ä¸Šä¼ ä»¥åŠæ–­ç‚¹ç»­ä¼ .html" class="sidebar-link">åŸºäºjsç®¡ç†å¤§æ–‡ä»¶ä¸Šä¼ ä»¥åŠæ–­ç‚¹ç»­ä¼ </a></li><li><a href="/advanced/3-é«˜çº§api/æ‰‹å†™ç®€æ˜“ç‰ˆçš„axios.html" class="sidebar-link">é¢è¯•å®˜ä¸è¦å†é—®æˆ‘axiosäº†ï¼Ÿæˆ‘èƒ½æ‰‹å†™ç®€æ˜“ç‰ˆçš„axios</a></li><li><a href="/advanced/3-é«˜çº§api/é¡µé¢ç”Ÿå‘½å‘¨æœŸ.html" class="sidebar-link">é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼šDOMContentLoadedï¼Œloadï¼Œbeforeunloadï¼Œunload</a></li></ul></section></li><li><a href="/advanced/CORSå®Œå…¨æ‰‹å†Œä¹‹CORSè¯¦è§£.html" class="sidebar-link">CORS å®Œå…¨æ‰‹å†Œä¹‹ CORS è¯¦è§£</a></li><li><a href="/advanced/ES12æ–°ç‰¹æ€§.html" class="sidebar-link">JavaScriptES12æ–°ç‰¹æ€§æŠ¢å…ˆä½“éªŒ</a></li><li><a href="/advanced/å‰ç«¯æ¨¡å—åŒ–.html" class="sidebar-link">å½»åº•æŒæ¡å‰ç«¯æ¨¡å—åŒ–</a></li><li><a href="/advanced/å˜é‡å’Œç±»å‹-1.html" class="sidebar-link">å˜é‡å’Œç±»å‹</a></li><li><a href="/advanced/å˜é‡å’Œç±»å‹-2.html" class="sidebar-link">å˜é‡å’Œç±»å‹-2</a></li><li><a href="/advanced/æ·±å…¥åˆ†æ JavaScript æ¨¡å—å¾ªç¯å¼•ç”¨.html" class="sidebar-link">æ·±å…¥åˆ†æ JavaScript æ¨¡å—å¾ªç¯å¼•ç”¨</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="axios-æ˜¯å¦‚ä½•å°è£…-http-è¯·æ±‚çš„"><a href="#axios-æ˜¯å¦‚ä½•å°è£…-http-è¯·æ±‚çš„" class="header-anchor">#</a> axios æ˜¯å¦‚ä½•å°è£… HTTP è¯·æ±‚çš„</h2> <blockquote><p><a href="https://mp.weixin.qq.com/s/Wbcjp3Lh44nrInFc3IX85w" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/Wbcjp3Lh44nrInFc3IX85w<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Axios æ¯‹åº¸å¤šè¯´å¤§å®¶åœ¨å‰ç«¯å¼€å‘ä¸­å¸¸ç”¨çš„ä¸€ä¸ªå‘é€ HTTP è¯·æ±‚çš„åº“ï¼Œç”¨è¿‡çš„éƒ½çŸ¥é“ã€‚æœ¬æ–‡ç”¨æ¥æ•´ç†é¡¹ç›®ä¸­å¸¸ç”¨çš„ Axios çš„å°è£…ä½¿ç”¨ã€‚åŒæ—¶å­¦ä¹ æºç ï¼Œæ‰‹å†™å®ç° Axios çš„æ ¸å¿ƒä»£ç ã€‚</p> <h3 id="axios-å¸¸ç”¨å°è£…"><a href="#axios-å¸¸ç”¨å°è£…" class="header-anchor">#</a> Axios å¸¸ç”¨å°è£…</h3> <h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> æ˜¯ä»€ä¹ˆ</h4> <p>Axios æ˜¯ä¸€ä¸ªåŸºäº promise çš„ HTTP åº“ï¼Œå¯ä»¥ç”¨åœ¨æµè§ˆå™¨å’Œ node.js ä¸­ã€‚å®ƒçš„ç‰¹æ€§ï¼š</p> <ul><li>ä»æµè§ˆå™¨ä¸­åˆ›å»º <code>XMLHttpRequests</code></li> <li>ä» node.js åˆ›å»º <code>http</code> è¯·æ±‚</li> <li>æ”¯æŒ <code>Promise</code> API</li> <li>æ‹¦æˆªè¯·æ±‚å’Œå“åº”</li> <li>è½¬æ¢è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®</li> <li>å–æ¶ˆè¯·æ±‚</li> <li>è‡ªåŠ¨è½¬æ¢ JSON æ•°æ®</li> <li>å®¢æˆ·ç«¯æ”¯æŒé˜²å¾¡ XSRFå®˜ç½‘åœ°å€ï¼šhttp://www.axios-js.com/zh-cn/docs/#axios-config</li></ul> <p>Axios ä½¿ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å…¨å±€çš„ Axios å¯¹è±¡ï¼›å¦å¤–ä¸€ç§æ˜¯é€šè¿‡ <code>axios.create(config)</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä½¿ç”¨è¯¥å¯¹è±¡ã€‚ä¸¤ç§æ–¹å¼çš„åŒºåˆ«æ˜¯é€šè¿‡ç¬¬äºŒç§æ–¹å¼åˆ›å»ºçš„å®ä¾‹å¯¹è±¡æ›´æ¸…çˆ½ä¸€äº›ï¼›å…¨å±€çš„ Axios å¯¹è±¡å…¶å®ä¹Ÿæ˜¯åˆ›å»ºçš„å®ä¾‹å¯¹è±¡å¯¼å‡ºçš„ï¼Œå®ƒæœ¬èº«ä¸ŠåŠ è½½äº†å¾ˆå¤šé»˜è®¤å±æ€§ã€‚åé¢æºç å­¦ä¹ çš„æ—¶å€™ä¼šå†è¯¦ç»†è¯´æ˜ã€‚</p> <h4 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="header-anchor">#</a> è¯·æ±‚</h4> <p>Axios è¿™ä¸ª HTTP çš„åº“æ¯”è¾ƒçµæ´»ï¼Œç»™ç”¨æˆ·å¤šç§å‘é€è¯·æ±‚çš„æ–¹å¼ï¼Œä»¥è‡³äºæœ‰äº›æ··ä¹±ã€‚ç»†å¿ƒæ•´ç†ä¼šå‘ç°ï¼Œå…¨å±€çš„ Axiosï¼ˆæˆ–è€… <code>axios.create(config)</code>åˆ›å»ºçš„å¯¹è±¡ï¼‰ æ—¢å¯ä»¥å½“ä½œå¯¹è±¡ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œå‡½æ•°ä½¿ç”¨ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// axios å½“ä½œå¯¹è±¡ä½¿ç”¨
axios.request(config)
axios.get(url[, config])
axios.post(url[, data[, config]])
// axios() å½“ä½œå‡½æ•°ä½¿ç”¨ã€‚ å‘é€ POST è¯·æ±‚
axios({
  method: 'post',
  url: '/user/12345',
  data: {
    firstName: 'Fred',
    lastName: 'Flintstone'
  }
});
</code></pre></div><p>åé¢æºç å­¦ä¹ çš„æ—¶å€™ä¼šå†è¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆ Axios å¯ä»¥å®ç°ä¸¤ç§æ–¹å¼çš„ä½¿ç”¨ã€‚</p> <h4 id="å–æ¶ˆè¯·æ±‚"><a href="#å–æ¶ˆè¯·æ±‚" class="header-anchor">#</a> å–æ¶ˆè¯·æ±‚</h4> <p>å¯ä»¥ä½¿ç”¨ <code>CancelToken.source</code> å·¥å‚æ–¹æ³•åˆ›å»º cancel tokenï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.get('/user/12345', {
  cancelToken: source.token
}).catch(function(thrown) {
  if (axios.isCancel(thrown)) {
    console.log('Request canceled', thrown.message);
  } else {
     // å¤„ç†é”™è¯¯
  }
});

// å–æ¶ˆè¯·æ±‚ï¼ˆmessage å‚æ•°æ˜¯å¯é€‰çš„ï¼‰
source.cancel('Operation canceled by the user.');
</code></pre></div><p>source æœ‰ä¸¤ä¸ªå±æ€§ï¼šä¸€ä¸ªæ˜¯ <code>source.token</code> æ ‡è¯†è¯·æ±‚ï¼›å¦ä¸€ä¸ªæ˜¯ <code>source.cancel()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨åï¼Œå¯ä»¥è®© CancelToken å®ä¾‹çš„ promise çŠ¶æ€å˜ä¸º <code>resolved</code>ï¼Œä»è€Œè§¦å‘ xhr å¯¹è±¡çš„ abort() æ–¹æ³•ï¼Œå–æ¶ˆè¯·æ±‚ã€‚</p> <h4 id="æ‹¦æˆª"><a href="#æ‹¦æˆª" class="header-anchor">#</a> æ‹¦æˆª</h4> <p>Axios è¿˜æœ‰ä¸€ä¸ªå¥‡å¦™çš„åŠŸèƒ½ç‚¹ï¼Œå¯ä»¥åœ¨å‘é€è¯·æ±‚å‰å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå¯¹ç›¸åº”ç»“æœè¿›è¡Œæ‹¦æˆªã€‚ç»“åˆä¸šåŠ¡åœºæ™¯çš„è¯ï¼Œåœ¨ä¸­å°ç³»ç»Ÿä¸­å®Œæˆç™»å½•åï¼Œè·å–åˆ°åç«¯è¿”å›çš„ tokenï¼Œå¯ä»¥å°† token æ·»åŠ åˆ° header ä¸­ï¼Œä»¥åæ‰€æœ‰çš„è¯·æ±‚è‡ªç„¶éƒ½ä¼šåŠ ä¸Šè¿™ä¸ªè‡ªå®šä¹‰ headerã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>//æ‹¦æˆª1 è¯·æ±‚æ‹¦æˆª
instance.interceptors.request.use(function(config){
    //åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ
    const token = sessionStorage.getItem('token');
    if(token){
        const newConfig = {
            ...config,
            headers: {
                token: token
            }
        }
        return newConfig;
    }else{
        return config;
    }
}, function(error){
    //å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
});
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨è¯·æ±‚æ‹¦æˆªåŠŸèƒ½å®ç° <strong>å–æ¶ˆé‡å¤è¯·æ±‚</strong>ï¼Œä¹Ÿå°±æ˜¯åœ¨å‰ä¸€ä¸ªè¯·æ±‚è¿˜æ²¡æœ‰è¿”å›ä¹‹å‰ï¼Œç”¨æˆ·é‡æ–°å‘é€äº†è¯·æ±‚ï¼Œéœ€è¦å…ˆå–æ¶ˆå‰ä¸€æ¬¡è¯·æ±‚ï¼Œå†å‘é€æ–°çš„è¯·æ±‚ã€‚æ¯”å¦‚æœç´¢æ¡†è‡ªåŠ¨æŸ¥è¯¢ï¼Œå½“ç”¨æˆ·ä¿®æ”¹äº†å†…å®¹é‡æ–°å‘é€è¯·æ±‚çš„æ—¶å€™éœ€è¦å–æ¶ˆå‰ä¸€æ¬¡è¯·æ±‚ï¼Œé¿å…è¯·æ±‚å’Œå“åº”æ··ä¹±ã€‚å†æ¯”å¦‚è¡¨å•æäº¤æŒ‰é’®ï¼Œç”¨æˆ·å¤šæ¬¡ç‚¹å‡»æäº¤æŒ‰é’®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å–æ¶ˆæ‰ä¹‹å‰çš„è¯·æ±‚ï¼Œä¿è¯åªæœ‰ä¸€æ¬¡è¯·æ±‚çš„å‘é€å’Œå“åº”ã€‚</p> <p>å®ç°åŸç†æ˜¯ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡è®°å½•å·²ç»å‘å‡ºå»çš„è¯·æ±‚ï¼Œåœ¨è¯·æ±‚æ‹¦æˆªå‡½æ•°ä¸­å…ˆåˆ¤æ–­è¿™ä¸ªå¯¹è±¡ä¸­æ˜¯å¦è®°å½•äº†æœ¬æ¬¡è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ï¼Œå°†æœ¬æ¬¡è¯·æ±‚æ·»åŠ è¿›å»å¯¹è±¡ä¸­ï¼›å¦‚æœæ²¡æœ‰è®°å½•è¿‡æœ¬æ¬¡è¯·æ±‚ï¼Œåˆ™å°†æœ¬æ¬¡è¯·æ±‚ä¿¡æ¯æ·»åŠ è¿›å¯¹è±¡ä¸­ã€‚æœ€åè¯·æ±‚å®Œæˆåï¼Œåœ¨å“åº”æ‹¦æˆªå‡½æ•°ä¸­æ‰§è¡Œåˆ é™¤æœ¬æ¬¡è¯·æ±‚ä¿¡æ¯çš„é€»è¾‘ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// æ‹¦æˆª2   é‡å¤è¯·æ±‚ï¼Œå–æ¶ˆå‰ä¸€ä¸ªè¯·æ±‚
const promiseArr = {};
instance.interceptors.request.use(function(config){
    console.log(Object.keys(promiseArr).length)
    //åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ
    let source=null;
    if(config.cancelToken){
        // config é…ç½®ä¸­å¸¦äº† source ä¿¡æ¯
        source = config.source;
    }else{
        const CancelToken = axios.CancelToken;
        source = CancelToken.source();
        config.cancelToken = source.token;
    }
    const currentKey = getRequestSymbol(config);
    if(promiseArr[currentKey]){
        const tmp = promiseArr[currentKey];
        tmp.cancel(&quot;å–æ¶ˆå‰ä¸€ä¸ªè¯·æ±‚&quot;);
        delete promiseArr[currentKey];
        promiseArr[currentKey] = source;
    }else{
        promiseArr[currentKey] = source;
    }
    return config;

}, function(error){
    //å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
});
// æ ¹æ® urlã€methodã€params ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼Œå¤§å®¶å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç”Ÿæˆè§„åˆ™
function getRequestSymbol(config){
    const arr = [];
    if(config.params){
        const data = config.params;
        for(let key of Object.keys(data)){
            arr.push(key+&quot;&amp;&quot;+data[key]);
        }
        arr.sort();
    }
    return config.url+config.method+arr.join(&quot;&quot;);
}

instance.interceptors.response.use(function(response){
    const currentKey = getRequestSymbol(response.config);
    delete promiseArr[currentKey];
    return response;
}, function(error){
    //å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
});
</code></pre></div><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å“åº”æ‹¦æˆªå‡½æ•°ä¸­ç»Ÿä¸€å¤„ç†è¿”å›ç çš„é€»è¾‘ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// å“åº”æ‹¦æˆª
instance.interceptors.response.use(function(response){
    // 401 æ²¡æœ‰ç™»å½•è·³è½¬åˆ°ç™»å½•é¡µé¢
    if(response.data.code===401){
        window.location.href = &quot;http://127.0.0.1:8080/#/login&quot;;
    }else if(response.data.code===403){
        // 403 æ— æƒé™è·³è½¬åˆ°æ— æƒé™é¡µé¢
        window.location.href = &quot;http://127.0.0.1:8080/#/noAuth&quot;;
    }
    return response;
}, function(error){
    //å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
})
</code></pre></div><h4 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="header-anchor">#</a> æ–‡ä»¶ä¸‹è½½</h4> <p>é€šå¸¸æ–‡ä»¶ä¸‹è½½æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„å¯¹å¤–åœ°å€ç›´æ¥ä¸‹è½½ï¼›è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡æ¥å£å°†æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æµçš„å½¢å¼ä¸‹è½½ã€‚</p> <p>ç¬¬ä¸€ç§ï¼š<strong>åŒåŸŸå</strong> ä¸‹ä½¿ç”¨ <code>a</code> æ ‡ç­¾ä¸‹è½½ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// httpServer.js
const express = require(&quot;express&quot;);
const path = require('path');
const app = express();

//é™æ€æ–‡ä»¶åœ°å€
app.use(express.static(path.join(__dirname, 'public')))
app.use(express.static(path.join(__dirname, '../')));
app.listen(8081, () =&gt; {
  console.log(&quot;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼&quot;)
});
// index.html
&lt;a href=&quot;test.txt&quot; download=&quot;test.txt&quot;&gt;ä¸‹è½½&lt;/a&gt;
</code></pre></div><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>ç¬¬äºŒç§ï¼šäºŒè¿›åˆ¶æ–‡ä»¶æµçš„å½¢å¼ä¼ é€’ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®è¯¥æ¥å£å¹¶ä¸èƒ½ä¸‹è½½æ–‡ä»¶ï¼Œä¸€å®šç¨‹åº¦ä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚æ¯”è¾ƒå¤šçš„åœºæ™¯æ˜¯ï¼šåç«¯æ¥æ”¶åˆ°æŸ¥è¯¢å‚æ•°ï¼ŒæŸ¥è¯¢æ•°æ®åº“ç„¶åé€šè¿‡æ’ä»¶åŠ¨æ€ç”Ÿæˆ excel æ–‡ä»¶ï¼Œä»¥æ–‡ä»¶æµçš„æ–¹å¼è®©å‰ç«¯ä¸‹è½½ã€‚</p> <p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚æ–‡ä»¶ä¸‹è½½çš„é€»è¾‘è¿›è¡Œå°è£…ã€‚å°†äºŒè¿›åˆ¶æ–‡ä»¶æµå­˜åœ¨ <code>Blob</code> å¯¹è±¡ä¸­ï¼Œå†å°†å…¶è½¬ä¸º url å¯¹è±¡ï¼Œæœ€åé€šè¿‡ a æ ‡ç­¾ä¸‹è½½ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>//å°è£…ä¸‹è½½
export function downLoadFetch(url, params = {}, config={}) {
    //å–æ¶ˆ
    const downSource = axios.CancelToken.source();
    document.getElementById('downAnimate').style.display = 'block';
    document.getElementById('cancelBtn').addEventListener('click', function(){
        downSource.cancel(&quot;ç”¨æˆ·å–æ¶ˆä¸‹è½½&quot;);
        document.getElementById('downAnimate').style.display = 'none';
    }, false);
    //å‚æ•°
    config.params = params;
    //è¶…æ—¶æ—¶é—´
    config.timeout = config.timeout ? config.timeout : defaultDownConfig.timeout;
    //ç±»å‹
    config.responseType = defaultDownConfig.responseType;
    //å–æ¶ˆä¸‹è½½
    config.cancelToken = downSource.token;
    return instance.get(url, config).then(response=&gt;{
        const content = response.data;
        const url = window.URL.createObjectURL(new Blob([content]));
        //åˆ›å»º a æ ‡ç­¾
        const link = document.createElement('a');
        link.style.display = 'none';
        link.href = url;
        //æ–‡ä»¶å  Content-Disposition: attachment; filename=download.txt
        const filename = response.headers['content-disposition'].split(&quot;;&quot;)[1].split(&quot;=&quot;)[1];
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        return {
            status: 200,
            success: true
        }
    })
}
</code></pre></div><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>https://juejin.cn/post/6878912072780873742</p> <h3 id="æ‰‹å†™-axios-æ ¸å¿ƒä»£ç "><a href="#æ‰‹å†™-axios-æ ¸å¿ƒä»£ç " class="header-anchor">#</a> æ‰‹å†™ Axios æ ¸å¿ƒä»£ç </h3> <p>å†™äº†è¿™ä¹ˆå¤šç”¨æ³•ç»ˆäºåˆ°æ­£é¢˜äº†ï¼Œæ‰‹å†™ Axios æ ¸å¿ƒä»£ç ã€‚Axios è¿™ä¸ªåº“æºç ä¸éš¾é˜…è¯»ï¼Œæ²¡æœ‰ç‰¹åˆ«å¤æ‚çš„é€»è¾‘ï¼Œå¤§å®¶å¯ä»¥æ”¾å¿ƒé˜…è¯» ğŸ˜‚ ã€‚</p> <p>æºç å…¥å£æ˜¯è¿™æ ·æŸ¥æ‰¾ï¼šåœ¨é¡¹ç›® <code>node_modules</code> ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° <code>axios</code> æ¨¡å—çš„ <code>package.json</code> æ–‡ä»¶ï¼Œå…¶ä¸­ <code>&quot;main&quot;: &quot;index.js&quot;,</code> å°±æ˜¯æ–‡ä»¶å…¥å£ã€‚ä¸€æ­¥æ­¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æºç æ˜¯æ€ä¹ˆä¸²èµ·æ¥çš„ã€‚</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>æ¨¡ä»¿ä¸Šé¢çš„ç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„ç›®å½•ç»“æ„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>axios-js
â”‚  index.html
â”‚  
â””â”€lib
        adapter.js
        Axios.js
        axiosInstance.js
        CancelToken.js
        InterceptorManager.js
</code></pre></div><h4 id="axios-æ˜¯ä»€ä¹ˆ"><a href="#axios-æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> Axios æ˜¯ä»€ä¹ˆ</h4> <p>ä¸Šé¢æœ‰æåˆ°æˆ‘ä»¬ä½¿ç”¨çš„å…¨å±€ Axios å¯¹è±¡å…¶å®ä¹Ÿæ˜¯æ„é€ å‡ºæ¥çš„ axiosï¼Œæ—¢å¯ä»¥å½“å¯¹è±¡ä½¿ç”¨è°ƒç”¨ getã€post ç­‰æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å½“ä½œå‡½æ•°ä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºå…¨å±€çš„ Axios å…¶å®æ˜¯å‡½æ•°å¯¹è±¡ <code>instance</code> ã€‚æºç ä½ç½®åœ¨ axios/lib/axios.js ä¸­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// axios/lib/axios.js
//åˆ›å»º axios å®ä¾‹
function createInstance(defaultConfig) {
  var context = new Axios(defaultConfig);
  //instance å¯¹è±¡æ˜¯ bind è¿”å›çš„å‡½æ•°
  var instance = bind(Axios.prototype.request, context);
  // Copy axios.prototype to instance
  utils.extend(instance, Axios.prototype, context);
  // Copy context to instance
  utils.extend(instance, context);
  return instance;
}

// å®ä¾‹ä¸€ä¸ª axios
var axios = createInstance(defaults);

// å‘è¿™ä¸ªå®ä¾‹æ·»åŠ  Axios å±æ€§
axios.Axios = Axios;

// å‘è¿™ä¸ªå®ä¾‹æ·»åŠ  create æ–¹æ³•
axios.create = function create(instanceConfig) {
  return createInstance(mergeConfig(axios.defaults, instanceConfig));
};
// å‘è¿™ä¸ªå®ä¾‹æ·»åŠ  CancelToken æ–¹æ³•
axios.CancelToken = require('./cancel/CancelToken');
// å¯¼å‡ºå®ä¾‹ axios
module.exports.default = axios;
</code></pre></div><p>æ ¹æ®ä¸Šé¢çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å†™ä¸€ä¸‹è‡ªå·±å®ç° Axios.js å’Œ axiosInstance.jsï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// Axios.js
//Axios ä¸»ä½“
function Axios(config){
}

// æ ¸å¿ƒæ–¹æ³•ï¼Œå‘é€è¯·æ±‚
Axios.prototype.request = function(config){
}

Axios.prototype.get = function(url, config={}){
    return this.request({url: url, method: 'GET', ...config});
}

Axios.prototype.post = function(url, data, config={}){
    return this.request({url: url, method: 'POST', data: data, ...config})
}
export default Axios;
</code></pre></div><p>åœ¨ axiosInstance.js æ–‡ä»¶ä¸­ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª Axios å¾—åˆ° contextï¼Œå†å°†åŸå‹å¯¹è±¡ä¸Šçš„æ–¹æ³•ç»‘å®šåˆ° instance å¯¹è±¡ä¸Šï¼ŒåŒæ—¶å°† context çš„å±æ€§æ·»åŠ åˆ° instance ä¸Šã€‚è¿™æ · instance å°±æˆä¸ºäº†ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚æ—¢å¯ä»¥å½“ä½œå¯¹è±¡ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œå‡½æ•°ä½¿ç”¨ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// axiosInstance.js
//åˆ›å»ºå®ä¾‹
function createInstance(config){
    const context = new Axios(config);
    var instance = Axios.prototype.request.bind(context);
    //å°† Axios.prototype å±æ€§æ‰©å±•åˆ° instance ä¸Š
    for(let k of Object.keys(Axios.prototype)){
        instance[k] = Axios.prototype[k].bind(context);
    }
    //å°† context å±æ€§æ‰©å±•åˆ° instance ä¸Š
    for(let k of Object.keys(context)){
        instance[k] = context[k]
    }
    return instance;
}

const axios = createInstance({});
axios.create = function(config){
    return createInstance(config);
}
export default axios;
</code></pre></div><p>ä¹Ÿå°±æ˜¯è¯´ axios.js ä¸­å¯¼å‡ºçš„ axios å¯¹è±¡å¹¶ä¸æ˜¯ <code>new Axios()</code> æ–¹æ³•è¿”å›çš„å¯¹è±¡ contextï¼Œè€Œæ˜¯ <code>Axios.prototype.request.bind(context)</code> æ‰§è¡Œè¿”å›çš„ <code>instance</code>ï¼Œé€šè¿‡éå† <code>Axios.prototype</code> å¹¶æ”¹å˜å…¶ this æŒ‡å‘åˆ° contextï¼›éå† context å¯¹è±¡è®© instance å¯¹è±¡å…·æœ‰ context çš„æ‰€æœ‰å±æ€§ã€‚è¿™æ · instance å¯¹è±¡å°±æ— æ•Œäº†ï¼ŒğŸ˜ æ—¢æ‹¥æœ‰äº† <code>Axios.prototype</code> ä¸Šçš„æ‰€æœ‰æ–¹æ³•ï¼Œåˆå…·æœ‰äº† context çš„æ‰€æœ‰å±æ€§ã€‚</p> <h4 id="è¯·æ±‚å®ç°"><a href="#è¯·æ±‚å®ç°" class="header-anchor">#</a> è¯·æ±‚å®ç°</h4> <p>æˆ‘ä»¬çŸ¥é“ Axios åœ¨æµè§ˆå™¨ä¸­ä¼šåˆ›å»º XMLHttpRequest å¯¹è±¡ï¼Œåœ¨ node.js ç¯å¢ƒä¸­åˆ›å»º http å‘é€è¯·æ±‚ã€‚<code>Axios.prototype.request()</code> æ˜¯å‘é€è¯·æ±‚çš„æ ¸å¿ƒæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å®è°ƒç”¨çš„æ˜¯ <code>dispatchRequest</code> æ–¹æ³•ï¼Œè€Œ <code>dispatchRequest</code> æ–¹æ³•è°ƒç”¨çš„æ˜¯ <code>config.adapter || defaults.adapter</code> ä¹Ÿå°±æ˜¯è‡ªå®šä¹‰çš„ adapter æˆ–è€…é»˜è®¤çš„ <code>defaults.adapter</code>ï¼Œé»˜è®¤<code>defaults.adapter</code> è°ƒç”¨çš„æ˜¯ getDefaultAdapter æ–¹æ³•ï¼Œæºç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function getDefaultAdapter() {
  var adapter;
  if (typeof XMLHttpRequest !== 'undefined') {
    // For browsers use XHR adapter
    adapter = require('./adapters/xhr');
  } else if (typeof process !== 'undefined' &amp;&amp; Object.prototype.toString.call(process) === '[object process]') {
    // For node use HTTP adapter
    adapter = require('./adapters/http');
  }
  return adapter;
}
</code></pre></div><p>å“ˆå“ˆå“ˆï¼ŒgetDefaultAdapter æ–¹æ³•æœ€ç»ˆæ ¹æ®å½“å‰çš„ç¯å¢ƒè¿”å›ä¸åŒçš„å®ç°æ–¹æ³•ï¼Œè¿™é‡Œç”¨åˆ°äº† <strong>é€‚é…å™¨æ¨¡å¼</strong>ã€‚æˆ‘ä»¬åªç”¨å®ç° xhr å‘é€è¯·æ±‚å³å¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//é€‚é…å™¨ adapter.js
function getDefaultAdapter(){
    var adapter;
    if(typeof XMLHttpRequest !== 'undefined'){
        //å¯¼å…¥ XHR å¯¹è±¡è¯·æ±‚
        adapter = (config)=&gt;{
            return xhrAdapter(config);
        }
    }
    return adapter;
}
function xhrAdapter(config){
    return new Promise((resolve, reject)=&gt;{
        var xhr = new XMLHttpRequest();
        xhr.open(config.method, config.url, true);
        xhr.send();
        xhr.onreadystatechange = ()=&gt;{
            if(xhr.readyState===4){
                if(xhr.status&gt;=200&amp;&amp;xhr.status&lt;300){
                    resolve({
                        data: {},
                        status: xhr.status,
                        statusText: xhr.statusText,
                        xhr: xhr
                    })
                }else{
                    reject({
                        status: xhr.status
                    })
                }
            }
        };
    })
}
export default getDefaultAdapter;
</code></pre></div><p>è¿™æ ·å°±ç†é¡ºäº†ï¼ŒgetDefaultAdapter æ–¹æ³•æ¯æ¬¡æ‰§è¡Œä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿™æ · Axios.prototype.request æ–¹æ³•å¯ä»¥å¾—åˆ°æ‰§è¡Œ xhr å‘é€è¯·æ±‚çš„ Promise å¯¹è±¡ã€‚</p> <p>ç»™æˆ‘ä»¬çš„ Axios.js æ·»åŠ å‘é€è¯·æ±‚çš„æ–¹æ³•ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//Axios.js
import getDefaultAdapter from './adapter.js';
Axios.prototype.request = function(config){
    const adapter = getDefaultAdapter(config);
    var promise = Promise.resolve(config);
    var chain = [adapter, undefined];
    while(chain.length){
        promise = promise.then(chain.shift(), chain.shift());
    }
    return promise;
}
</code></pre></div><h4 id="æ‹¦æˆªå™¨å®ç°"><a href="#æ‹¦æˆªå™¨å®ç°" class="header-anchor">#</a> æ‹¦æˆªå™¨å®ç°</h4> <p>æ‹¦æˆªå™¨çš„åŸç†åœ¨äº <code>Axios.prototype.request</code> æ–¹æ³•ä¸­çš„ <code>chain</code> æ•°ç»„ï¼ŒæŠŠè¯·æ±‚æ‹¦æˆªå‡½æ•°æ·»åŠ åˆ° <code>chain</code> æ•°ç»„å‰é¢ï¼ŒæŠŠå“åº”æ‹¦æˆªå‡½æ•°æ·»åŠ åˆ°æ•°ç»„åé¢ã€‚è¿™æ ·å°±å¯ä»¥å®ç°å‘é€å‰æ‹¦æˆªå’Œå“åº”åæ‹¦æˆªçš„æ•ˆæœã€‚<img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡">åˆ›å»º InterceptorManager.js</p> <div class="language- extra-class"><pre class="language-text"><code>//InterceptorManager.js 
//æ‹¦æˆªå™¨
function InterceptorManager(){
    this.handlers = [];
}
InterceptorManager.prototype.use = function(fulfilled, rejected){
    this.handlers.push({
        fulfilled: fulfilled,
        rejected: rejected
    });
    return this.handlers.length -1;
}

export default InterceptorManager;
</code></pre></div><p>åœ¨ Axios.js æ–‡ä»¶ä¸­ï¼Œæ„é€ å‡½æ•°æœ‰ <code>interceptors</code>å±æ€§ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//Axios.js
function Axios(config){
    this.interceptors = {
        request: new InterceptorManager(),
        response: new InterceptorManager()
    }
}
</code></pre></div><p>è¿™æ ·æˆ‘ä»¬åœ¨ Axios.prototype.request æ–¹æ³•ä¸­å¯¹æ‹¦æˆªå™¨æ·»åŠ å¤„ç†ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//Axios.js
Axios.prototype.request = function(config){
    const adapter = getDefaultAdapter(config);
    var promise = Promise.resolve(config);
    var chain = [adapter, undefined];
    //è¯·æ±‚æ‹¦æˆª
    this.interceptors.request.handlers.forEach(item=&gt;{
        chain.unshift(item.rejected);
        chain.unshift(item.fulfilled);
        
    });
    //å“åº”æ‹¦æˆª
    this.interceptors.response.handlers.forEach(item=&gt;{
        chain.push(item.fulfilled);
        chain.push(item.rejected)
    });
    console.dir(chain);
    while(chain.length){
        promise = promise.then(chain.shift(), chain.shift());
    }
    return promise;
}
</code></pre></div><p>æ‰€ä»¥æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š<code>è¯·æ±‚æ‹¦æˆª2 -&gt; è¯·æ±‚æ‹¦æˆª1 -&gt; å‘é€è¯·æ±‚ -&gt; å“åº”æ‹¦æˆª1 -&gt; å“åº”æ‹¦æˆª2</code></p> <h4 id="å–æ¶ˆè¯·æ±‚-2"><a href="#å–æ¶ˆè¯·æ±‚-2" class="header-anchor">#</a> å–æ¶ˆè¯·æ±‚</h4> <p>æ¥åˆ° Axios æœ€ç²¾å½©çš„éƒ¨åˆ†äº†ï¼Œå–æ¶ˆè¯·æ±‚ã€‚æˆ‘ä»¬çŸ¥é“ xhr çš„ <code>xhr.abort();</code> å‡½æ•°å¯ä»¥å–æ¶ˆè¯·æ±‚ã€‚é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ‰§è¡Œè¿™ä¸ªå–æ¶ˆè¯·æ±‚çš„æ“ä½œå‘¢ï¼Ÿå¾—æœ‰ä¸€ä¸ªä¿¡å·å‘Šè¯‰ xhr å¯¹è±¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå–æ¶ˆæ“ä½œã€‚å–æ¶ˆè¯·æ±‚å°±æ˜¯æœªæ¥æŸä¸ªæ—¶å€™è¦åšçš„äº‹æƒ…ï¼Œä½ èƒ½æƒ³åˆ°ä»€ä¹ˆå‘¢ï¼Ÿå¯¹ï¼Œå°±æ˜¯ Promiseã€‚Promise çš„ <code>then</code>æ–¹æ³•åªæœ‰ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸º resolved çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œåœ¨ Promise å¯¹è±¡çš„ then æ–¹æ³•ä¸­æ‰§è¡Œå–æ¶ˆè¯·æ±‚çš„æ“ä½œã€‚çœ‹ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//CancelToken.js
// å–æ¶ˆè¯·æ±‚
function CancelToken(executor){
    if(typeof executor !== 'function'){
        throw new TypeError('executor must be a function.')
    }
    var resolvePromise;
    this.promise = new Promise((resolve)=&gt;{
        resolvePromise = resolve;
    });
    executor(resolvePromise)
}
CancelToken.source = function(){
    var cancel;
    var token = new CancelToken((c)=&gt;{
        cancel = c;
    })
    return {
        token,
        cancel
    };
}
export default CancelToken;
</code></pre></div><p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>const source = CancelToken.source()</code>çš„æ—¶å€™ï¼Œsource å¯¹è±¡æœ‰ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯ token å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯ cancel å‡½æ•°ã€‚åœ¨ xhr è¯·æ±‚ä¸­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//é€‚é…å™¨
// adapter.js
function xhrAdapter(config){
    return new Promise((resolve, reject)=&gt;{
        ...
        //å–æ¶ˆè¯·æ±‚
        if(config.cancelToken){
            // åªæœ‰ resolved çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œå–æ¶ˆæ“ä½œ
            config.cancelToken.promise.then(function onCanceled(cancel){
                if(!xhr){
                    return;
                }
                xhr.abort();
                reject(&quot;è¯·æ±‚å·²å–æ¶ˆ&quot;);
                // clean up xhr
                xhr = null;
            })
        }
    })
}
</code></pre></div><p>CancelToken çš„æ„é€ å‡½æ•°ä¸­éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å…¶å®æ˜¯ä¸ºäº†å°†èƒ½æ§åˆ¶å†…éƒ¨ Promise çš„ resolve å‡½æ•°æš´éœ²å‡ºå»ï¼Œæš´éœ²ç»™ source çš„ cancel å‡½æ•°ã€‚è¿™æ ·å†…éƒ¨çš„ Promise çŠ¶æ€å°±å¯ä»¥é€šè¿‡ <code>source.cancel()</code> æ–¹æ³•æ¥æ§åˆ¶å•¦ï¼Œç§’å•Š~ ğŸ‘</p> <h3 id="node-åç«¯æ¥å£"><a href="#node-åç«¯æ¥å£" class="header-anchor">#</a> node åç«¯æ¥å£</h3> <p>node åç«¯ç®€å•çš„æ¥å£ä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const express = require(&quot;express&quot;);
const bodyParser = require('body-parser');
const app = express();
const router = express.Router();
//æ–‡ä»¶ä¸‹è½½
const fs = require(&quot;fs&quot;);
// get è¯·æ±‚
router.get(&quot;/getCount&quot;, (req, res)=&gt;{
  setTimeout(()=&gt;{
    res.json({
      success: true,
      code: 200,
      data: 100
    })
  }, 1000)
})


// äºŒè¿›åˆ¶æ–‡ä»¶æµ
router.get('/downFile', (req, res, next) =&gt; {
  var name = 'download.txt';
  var path = './' + name;
  var size = fs.statSync(path).size;
  var f = fs.createReadStream(path);
  res.writeHead(200, {
    'Content-Type': 'application/force-download',
    'Content-Disposition': 'attachment; filename=' + name,
    'Content-Length': size
  });
  f.pipe(res);
})

// è®¾ç½®è·¨åŸŸè®¿é—®
app.all(&quot;*&quot;, function (request, response, next) {
  // è®¾ç½®è·¨åŸŸçš„åŸŸåï¼Œ* ä»£è¡¨å…è®¸ä»»æ„åŸŸåè·¨åŸŸï¼›http://localhost:8080 è¡¨ç¤ºå‰ç«¯è¯·æ±‚çš„ Origin åœ°å€
  response.header(&quot;Access-Control-Allow-Origin&quot;, &quot;http://127.0.0.1:5500&quot;);
  //è®¾ç½®è¯·æ±‚å¤´ header å¯ä»¥åŠ é‚£äº›å±æ€§
  response.header('Access-Control-Allow-Headers', 'Content-Type, Content-Length, Authorization, Accept, X-Requested-With');
  //æš´éœ²ç»™ axios https://blog.csdn.net/w345731923/article/details/114067074
  response.header(&quot;Access-Control-Expose-Headers&quot;, &quot;Content-Disposition&quot;);
  // è®¾ç½®è·¨åŸŸå¯ä»¥æºå¸¦ Cookie ä¿¡æ¯
  response.header('Access-Control-Allow-Credentials', &quot;true&quot;);
  //è®¾ç½®è¯·æ±‚å¤´å“ªäº›æ–¹æ³•æ˜¯åˆæ³•çš„
  response.header(
    &quot;Access-Control-Allow-Methods&quot;,
    &quot;PUT,POST,GET,DELETE,OPTIONS&quot;
  );
  response.header(&quot;Content-Type&quot;, &quot;application/json;charset=utf-8&quot;);
  next();
});

// æ¥å£æ•°æ®è§£æ
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({
  extended: false
}))
app.use('/api', router) // è·¯ç”±æ³¨å†Œ

app.listen(8081, () =&gt; {
  console.log(&quot;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼&quot;)
});
</code></pre></div><h3 id="git-åœ°å€"><a href="#git-åœ°å€" class="header-anchor">#</a> git åœ°å€</h3> <p>å¦‚æœå¤§å®¶èƒ½å¤Ÿè·Ÿç€æºç æ•²ä¸€éï¼Œç›¸ä¿¡ä¸€å®šä¼šæœ‰å¾ˆå¤šæ”¶è·ã€‚</p> <p>æ‰‹å†™ Axios æ ¸å¿ƒä»£ç  github åœ°å€ï¼šhttps://github.com/YY88Xu/axios-js
Axios å°è£…ï¼šhttps://github.com/YY88Xu/vue2-component</p> <p>- EOF -</p> <p>æ¨èé˜…è¯» ç‚¹å‡»æ ‡é¢˜å¯è·³è½¬</p> <p>1ã€<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=2651578212&amp;idx=2&amp;sn=3a4bdc17b0c1808f2b5649d84eff93a1&amp;chksm=802508a5b75281b366dca8441c3ab2dc63b93adcd139ec5bb002dc8b10fef80efa49d49d92c2&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">vue ä¸­ Axios çš„å°è£…å’Œ API æ¥å£çš„ç®¡ç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>2ã€<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=2651576212&amp;idx=2&amp;sn=b1c3fac9534f01f4d7c68f7b88800d5c&amp;chksm=80250055b75289430570c54ba104675cbc6e5cf15cd35154a63f1d89b9f7211fb2f88f232e0f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">Axios å¦‚ä½•å–æ¶ˆé‡å¤è¯·æ±‚ï¼Ÿ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>3ã€<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=2651576184&amp;idx=2&amp;sn=58e01488d9c22b3de224e88df91ca93e&amp;chksm=802500b9b75289afb55f9a448c6e3d3767fa5d0fba526696dea07e0f9bf167a4cd32791f373d&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">ç»å¾—ä½æ‹·é—®çš„ HTTPS åŸç†è§£æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/27/2022, 9:04:59 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/advanced/3-é«˜çº§api/JSB åŸç†ä¸å®è·µ.html" class="prev">
        JSB åŸç†ä¸å®è·µ
      </a></span> <span class="next"><a href="/advanced/3-é«˜çº§api/mutation-observer.html">
        DOM å˜åŠ¨è§‚å¯Ÿå™¨ï¼ˆMutation observerï¼‰
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.6df8e219.js" defer></script><script src="/assets/js/2.e21ead49.js" defer></script><script src="/assets/js/19.553ed8c2.js" defer></script>
  </body>
</html>
