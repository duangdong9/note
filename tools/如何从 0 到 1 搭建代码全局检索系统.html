<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何从 0 到 1 搭建代码全局检索系统 | duangdong的note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="前端相关知识归纳总结">
    <meta name="keywords" content="qd-blog,node,vuepress,leetcode,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.a427ee9b.css" as="style"><link rel="preload" href="/assets/js/app.6df8e219.js" as="script"><link rel="preload" href="/assets/js/2.e21ead49.js" as="script"><link rel="preload" href="/assets/js/140.ce3a69fc.js" as="script"><link rel="prefetch" href="/assets/js/10.e0bdad61.js"><link rel="prefetch" href="/assets/js/100.82a4c820.js"><link rel="prefetch" href="/assets/js/101.f5d94e3b.js"><link rel="prefetch" href="/assets/js/102.7f36fa51.js"><link rel="prefetch" href="/assets/js/103.085df24a.js"><link rel="prefetch" href="/assets/js/104.76789169.js"><link rel="prefetch" href="/assets/js/105.9efb3db9.js"><link rel="prefetch" href="/assets/js/106.22337f5b.js"><link rel="prefetch" href="/assets/js/107.ac8e17b4.js"><link rel="prefetch" href="/assets/js/108.5fe47bcc.js"><link rel="prefetch" href="/assets/js/109.cf88a409.js"><link rel="prefetch" href="/assets/js/11.e801cea9.js"><link rel="prefetch" href="/assets/js/110.603c3bd4.js"><link rel="prefetch" href="/assets/js/111.26f89c7d.js"><link rel="prefetch" href="/assets/js/112.1ad5bc54.js"><link rel="prefetch" href="/assets/js/113.cde31a40.js"><link rel="prefetch" href="/assets/js/114.a1a2a895.js"><link rel="prefetch" href="/assets/js/115.31c25d8b.js"><link rel="prefetch" href="/assets/js/116.8ed4b493.js"><link rel="prefetch" href="/assets/js/117.c802c1ce.js"><link rel="prefetch" href="/assets/js/118.15aead28.js"><link rel="prefetch" href="/assets/js/119.c26b6aad.js"><link rel="prefetch" href="/assets/js/12.9ed8f981.js"><link rel="prefetch" href="/assets/js/120.c3410f53.js"><link rel="prefetch" href="/assets/js/121.357fc3f4.js"><link rel="prefetch" href="/assets/js/122.6ecee0a8.js"><link rel="prefetch" href="/assets/js/123.6b38e86a.js"><link rel="prefetch" href="/assets/js/124.463231bb.js"><link rel="prefetch" href="/assets/js/125.dc9f9675.js"><link rel="prefetch" href="/assets/js/126.97f340de.js"><link rel="prefetch" href="/assets/js/127.080209f1.js"><link rel="prefetch" href="/assets/js/128.dd7fed27.js"><link rel="prefetch" href="/assets/js/129.e9a49c7b.js"><link rel="prefetch" href="/assets/js/13.fb60e043.js"><link rel="prefetch" href="/assets/js/130.86b31ea7.js"><link rel="prefetch" href="/assets/js/131.be4dca8f.js"><link rel="prefetch" href="/assets/js/132.a4e032bd.js"><link rel="prefetch" href="/assets/js/133.545d53fa.js"><link rel="prefetch" href="/assets/js/134.ef4512f0.js"><link rel="prefetch" href="/assets/js/135.b15ec030.js"><link rel="prefetch" href="/assets/js/136.14e63782.js"><link rel="prefetch" href="/assets/js/137.671e87f8.js"><link rel="prefetch" href="/assets/js/138.b3d28a52.js"><link rel="prefetch" href="/assets/js/139.bc5e381c.js"><link rel="prefetch" href="/assets/js/14.63057fe7.js"><link rel="prefetch" href="/assets/js/141.09737b5b.js"><link rel="prefetch" href="/assets/js/142.49e3bb24.js"><link rel="prefetch" href="/assets/js/143.45031fa6.js"><link rel="prefetch" href="/assets/js/144.458e287e.js"><link rel="prefetch" href="/assets/js/145.9d21ff24.js"><link rel="prefetch" href="/assets/js/146.88d47473.js"><link rel="prefetch" href="/assets/js/147.277b5759.js"><link rel="prefetch" href="/assets/js/148.0dd5c138.js"><link rel="prefetch" href="/assets/js/149.d638ab21.js"><link rel="prefetch" href="/assets/js/15.3ac2cfb4.js"><link rel="prefetch" href="/assets/js/150.834eb5ca.js"><link rel="prefetch" href="/assets/js/151.0b833f48.js"><link rel="prefetch" href="/assets/js/152.d212207c.js"><link rel="prefetch" href="/assets/js/153.e8b1311a.js"><link rel="prefetch" href="/assets/js/154.74eb8531.js"><link rel="prefetch" href="/assets/js/16.f2129a31.js"><link rel="prefetch" href="/assets/js/17.27a38c73.js"><link rel="prefetch" href="/assets/js/18.ec5b4213.js"><link rel="prefetch" href="/assets/js/19.553ed8c2.js"><link rel="prefetch" href="/assets/js/20.c1bf3bbb.js"><link rel="prefetch" href="/assets/js/21.5790bc21.js"><link rel="prefetch" href="/assets/js/22.29894e1b.js"><link rel="prefetch" href="/assets/js/23.bae1a497.js"><link rel="prefetch" href="/assets/js/24.1edc62bc.js"><link rel="prefetch" href="/assets/js/25.69b254ca.js"><link rel="prefetch" href="/assets/js/26.df57f236.js"><link rel="prefetch" href="/assets/js/27.9ae48125.js"><link rel="prefetch" href="/assets/js/28.d42d4bb6.js"><link rel="prefetch" href="/assets/js/29.f3630e2f.js"><link rel="prefetch" href="/assets/js/3.5c47a171.js"><link rel="prefetch" href="/assets/js/30.40cf5507.js"><link rel="prefetch" href="/assets/js/31.99b2787c.js"><link rel="prefetch" href="/assets/js/32.eef578d9.js"><link rel="prefetch" href="/assets/js/33.6755a6d2.js"><link rel="prefetch" href="/assets/js/34.add65d5c.js"><link rel="prefetch" href="/assets/js/35.3e4a0da9.js"><link rel="prefetch" href="/assets/js/36.9d4bd3f9.js"><link rel="prefetch" href="/assets/js/37.98506fd6.js"><link rel="prefetch" href="/assets/js/38.44bce283.js"><link rel="prefetch" href="/assets/js/39.62bf281f.js"><link rel="prefetch" href="/assets/js/4.8f6f0475.js"><link rel="prefetch" href="/assets/js/40.3a389edd.js"><link rel="prefetch" href="/assets/js/41.a309beb7.js"><link rel="prefetch" href="/assets/js/42.4e87216c.js"><link rel="prefetch" href="/assets/js/43.c6f6922b.js"><link rel="prefetch" href="/assets/js/44.fda8b3de.js"><link rel="prefetch" href="/assets/js/45.5a1c5b3b.js"><link rel="prefetch" href="/assets/js/46.289cbb81.js"><link rel="prefetch" href="/assets/js/47.81850ce8.js"><link rel="prefetch" href="/assets/js/48.e986629d.js"><link rel="prefetch" href="/assets/js/49.d04a41c3.js"><link rel="prefetch" href="/assets/js/5.8b87f02a.js"><link rel="prefetch" href="/assets/js/50.727fb121.js"><link rel="prefetch" href="/assets/js/51.a10ac8b0.js"><link rel="prefetch" href="/assets/js/52.4fffa0ef.js"><link rel="prefetch" href="/assets/js/53.03ab34e0.js"><link rel="prefetch" href="/assets/js/54.f05ee208.js"><link rel="prefetch" href="/assets/js/55.f90df177.js"><link rel="prefetch" href="/assets/js/56.86a4d03e.js"><link rel="prefetch" href="/assets/js/57.c8cee71c.js"><link rel="prefetch" href="/assets/js/58.0b503f53.js"><link rel="prefetch" href="/assets/js/59.c4daebc4.js"><link rel="prefetch" href="/assets/js/6.2f86309f.js"><link rel="prefetch" href="/assets/js/60.b9584ba1.js"><link rel="prefetch" href="/assets/js/61.fa6e5de3.js"><link rel="prefetch" href="/assets/js/62.4f67908f.js"><link rel="prefetch" href="/assets/js/63.0c9d8ccc.js"><link rel="prefetch" href="/assets/js/64.2754e515.js"><link rel="prefetch" href="/assets/js/65.f2bd6dd5.js"><link rel="prefetch" href="/assets/js/66.299c952c.js"><link rel="prefetch" href="/assets/js/67.2ccaf3ef.js"><link rel="prefetch" href="/assets/js/68.b6e197f0.js"><link rel="prefetch" href="/assets/js/69.b821ea5d.js"><link rel="prefetch" href="/assets/js/7.f1cc41de.js"><link rel="prefetch" href="/assets/js/70.7beae76c.js"><link rel="prefetch" href="/assets/js/71.d452a791.js"><link rel="prefetch" href="/assets/js/72.f3fd5168.js"><link rel="prefetch" href="/assets/js/73.0804c5f0.js"><link rel="prefetch" href="/assets/js/74.cdcdfbcc.js"><link rel="prefetch" href="/assets/js/75.e8e01c97.js"><link rel="prefetch" href="/assets/js/76.6801837d.js"><link rel="prefetch" href="/assets/js/77.04408d97.js"><link rel="prefetch" href="/assets/js/78.9130c8b3.js"><link rel="prefetch" href="/assets/js/79.dcf60589.js"><link rel="prefetch" href="/assets/js/8.89fa1943.js"><link rel="prefetch" href="/assets/js/80.efe0c1a1.js"><link rel="prefetch" href="/assets/js/81.8220fef3.js"><link rel="prefetch" href="/assets/js/82.ae2099d2.js"><link rel="prefetch" href="/assets/js/83.c563f161.js"><link rel="prefetch" href="/assets/js/84.e365194b.js"><link rel="prefetch" href="/assets/js/85.15de0cdb.js"><link rel="prefetch" href="/assets/js/86.b99959c5.js"><link rel="prefetch" href="/assets/js/87.6fccf3fc.js"><link rel="prefetch" href="/assets/js/88.9bc0613a.js"><link rel="prefetch" href="/assets/js/89.89530022.js"><link rel="prefetch" href="/assets/js/9.7637f327.js"><link rel="prefetch" href="/assets/js/90.53d12303.js"><link rel="prefetch" href="/assets/js/91.c55896d7.js"><link rel="prefetch" href="/assets/js/92.0fe1f724.js"><link rel="prefetch" href="/assets/js/93.d681c01d.js"><link rel="prefetch" href="/assets/js/94.ed89d267.js"><link rel="prefetch" href="/assets/js/95.96e675de.js"><link rel="prefetch" href="/assets/js/96.5ad7361e.js"><link rel="prefetch" href="/assets/js/97.e7f32727.js"><link rel="prefetch" href="/assets/js/98.c3a03e67.js"><link rel="prefetch" href="/assets/js/99.31f54446.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a427ee9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdong的note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/principle/" class="nav-link">
  JS执行
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  JS设计模式
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  JS进阶
</a></div><div class="nav-item"><a href="/advanced-function/" class="nav-link">
  高阶函数
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/eight-essay/" class="nav-link">
  八股文
</a></div><div class="nav-item"><a href="/hand-writing/" class="nav-link">
  手写实现
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  工具方法
</a></div><div class="nav-item"><a href="https://link.qdzhou.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/principle/" class="nav-link">
  JS执行
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  JS设计模式
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  JS进阶
</a></div><div class="nav-item"><a href="/advanced-function/" class="nav-link">
  高阶函数
</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/eight-essay/" class="nav-link">
  八股文
</a></div><div class="nav-item"><a href="/hand-writing/" class="nav-link">
  手写实现
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  工具方法
</a></div><div class="nav-item"><a href="https://link.qdzhou.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tools/" aria-current="page" class="sidebar-link">八股文</a></li><li><a href="/tools/15分钟学会Immutable.html" class="sidebar-link">15分钟学会Immutable</a></li><li><a href="/tools/JS 图片压缩.html" class="sidebar-link">ZooTeam</a></li><li><a href="/tools/axios怎么封装.html" class="sidebar-link">axios怎么封装，才能提升效率？</a></li><li><a href="/tools/rc-form.html" class="sidebar-link">最熟悉的陌生人rc-form</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码片段</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/tools/位运算.html" class="sidebar-link">JS中运算符</a></li><li><a href="/tools/如何从 0 到 1 搭建代码全局检索系统.html" class="active sidebar-link">如何从 0 到 1 搭建代码全局检索系统</a></li><li><a href="/tools/如何实现高性能的在线 PDF 预览.html" class="sidebar-link">如何实现高性能的在线 PDF 预览</a></li><li><a href="/tools/手写一个虚拟DOM库.html" class="sidebar-link">手写一个虚拟DOM库，彻底让你理解diff算法</a></li><li><a href="/tools/文件下载.html" class="sidebar-link">文件下载，搞懂这9种场景就够了</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何从-0-到-1-搭建代码全局检索系统"><a href="#如何从-0-到-1-搭建代码全局检索系统" class="header-anchor">#</a> 如何从 0 到 1 搭建代码全局检索系统</h1> <blockquote><p><a href="https://www.zoo.team/article/checkcode" target="_blank" rel="noopener noreferrer">https://www.zoo.team/article/checkcode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>目前，前端团队的项目有几百个左右，想要查找某个接口 API 或者某个 NPM 包以及一些关键词在哪些项目中使用到，需要每个开发同学在自己维护的项目里全局搜索一遍或者写个脚本跑一遍，然后统计上去，实际上，这是一个比较耗费人力资源和时间的事情。于是，代码全局检索系统——千寻“应运而生”，其核心借助于 <code>Elasticsearch</code> 强大的全文检索能力。</p> <p>正文开始之前，先揭开 “千寻“ 神秘的 ”面纱“ ，效果图如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_86679b0db5294e583633ad340c1223ac.gif" alt="qianxun.gif"></p> <h3 id="elasticsearch-是什么"><a href="#elasticsearch-是什么" class="header-anchor">#</a> Elasticsearch 是什么？</h3> <p><code>Elasticsearch</code> ，简称 ES，是一个分布式可拓展的实时搜索和分析引擎，它的底层是开源库 <code>Apache Lucene</code>，也就是说 <code>Elastic</code> 是 <code>Lucene</code> 的二次封装。如果你想访问 <code>Elasticsearch</code>，可以直接使用 HTTP 的 RestFul API 方式，来增删改查。说到增删改查，我们很容易想到关系型数据库。</p> <p>这里，有一份简单的术语对照表：</p> <table><thead><tr><th style="text-align:center;">关系型数据库</th> <th style="text-align:center;">数据库</th> <th style="text-align:center;">表</th> <th style="text-align:center;">行</th> <th style="text-align:center;">列</th></tr></thead> <tbody><tr><td style="text-align:center;">Elasticsearch</td> <td style="text-align:center;">索引(Index)</td> <td style="text-align:center;">类型(Type)</td> <td style="text-align:center;">文档(Document)</td> <td style="text-align:center;">字段(Fields)</td></tr></tbody></table> <p>即，Elasticsearch 的索引、类型、文档、字段分别类比关系型数据库的数据库、表、行、列。</p> <p>看完之后，是不是对 <code>Elasticsearch</code> 有了初步的概念。为了不损耗大家的脑细胞，点到为止，有感兴趣的小伙伴，可以去查阅相关资料，深入了解（ <a href="https://www.kancloud.cn/yiyanan/elasticsearch_7_6/1651637" target="_blank" rel="noopener noreferrer">Elasticsearch7.6中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ）。</p> <h3 id="整体设计架构"><a href="#整体设计架构" class="header-anchor">#</a> 整体设计架构</h3> <p><img src="https://gitee.com/qdzhou/img-upload/raw/master/images/202112171722039.png" alt="qianxun.png"></p> <h4 id="node-server"><a href="#node-server" class="header-anchor">#</a> Node-server</h4> <p>主服务，负责执行 <code>Node-fscrawler</code> 脚手架相关命令，以及对外提供项目录入、查询等能力。</p> <h4 id="gitlab"><a href="#gitlab" class="header-anchor">#</a> GitLab</h4> <p>通过调用 GitLab API，来获取或下载项目。这里推荐一个插件 <code>gitbeaker</code>，对 GitLab API 做了二次封装，用起来还是蛮香的。分页获取有权限的项目列表，如下图所示：</p> <p><img src="https://www.zoo.team/images/upload/upload_1fc98b4ae29133075663f36645d38bd7.png" alt="gitbeaker.png"></p> <h4 id="node-fscrawler"><a href="#node-fscrawler" class="header-anchor">#</a> Node-fscrawler</h4> <p>下载并爬取项目文件，然后生成一份 JSON 文件，最后通过调用 Elasticsearch API ，实现项目文件导入到 ES。</p> <h4 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h4> <p>全文检索服务，提供代码全局检索能力。目前用的版本是 7.9.3，这里用了第三方 <code>Elasticsearch</code> 的 Node 版的一个包，<code>elasticsearch.js</code> 上手十分轻松，只需几行代码，就可以玩转 <code>Elasticsearch</code> ^ _ ^</p> <p><img src="https://www.zoo.team/images/upload/upload_46b50fd6a123739676a7d15738334d4d.png" alt="es client.png"></p> <h4 id="mysql"><a href="#mysql" class="header-anchor">#</a> Mysql</h4> <p>持久化存储项目信息、项目文件内容、搜索数据统计等等。</p> <h3 id="整体流程"><a href="#整体流程" class="header-anchor">#</a> 整体流程</h3> <h4 id="项目信息录入"><a href="#项目信息录入" class="header-anchor">#</a> 项目信息录入</h4> <p>将项目相关信息存储到 <code>MYSQL</code>数据库，这里有四种录入方式，<strong>项目名称</strong>、<strong>项目</strong> <strong>ID</strong>、<strong>项目组名称</strong>、<strong>项目组</strong> <strong>ID</strong>，其中 <strong>项目名称</strong> 和 <strong>项目</strong> <strong>ID</strong> 针对单个项目的录入，当需要录入某个组下的所有项目时可使用传入<strong>项目组名称</strong> 或 <strong>项目</strong> <strong>ID</strong>。最后，可选择需要录入的项目手动录入。</p> <p><img src="https://www.zoo.team/images/upload/upload_19af4a85294e2c4da2f2ca8c05ed2c1e.png" alt="项目信息录入.png"></p> <p>效果图如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_4562b5c8f26fb87e4b7c5f63c1d1dde6.gif" alt="项目信息录入.gif"></p> <h4 id="项目文件同步到-es"><a href="#项目文件同步到-es" class="header-anchor">#</a> 项目文件同步到 ES</h4> <p>同步分为<strong>单项同步</strong>和<strong>批量同步</strong>，<strong>批量同步</strong>其实就是递归多个项目然后执行<strong>单项同步</strong>的操作。首先，发起同步请求，主服务会执行脚手架命令 <code>fscrawler syncES &lt;projectName&gt;</code> ，如果本地根目录下（ .node-fscrawler 默认根目录）没有找到该项目名称的目录，会先下载并解压该项目到默认根目录下，然后根据生成特地结构数据的 JSON 文件，最后读取该 JSON 文件数据并调用 Elasticsearch Bulk API 批量导入到 ES。</p> <p>核心代码如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_9285d6e8603a323b8fc0e5f27e69f3fd.png" alt="crawProjectsBluk.png"></p> <h4 id="代码全局检索"><a href="#代码全局检索" class="header-anchor">#</a> 代码全局检索</h4> <p>至此，项目文件的数据已经导入到 ES 了，那么，接下来最重要的就是关键词搜索并呈现出结果。搜索页面主要信息有：项目名称、搜索结果、项目描述、项目负责人等，点击项目名称和搜索结果会跳转到对应的 GitLab 仓库的项目和文件页面。由于项目文件内容基本都是英文，则采用 <strong>Standard</strong> 分词器，如果你想对中文分词，可以推荐使用 <strong>IK</strong> 分词器。</p> <p>核心代码如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_4b2954cc3fa06c7eee7eb180055cbe66.png" alt="query.png"></p> <h3 id="核心设计"><a href="#核心设计" class="header-anchor">#</a> 核心设计</h3> <h4 id="主服务消息中心设计"><a href="#主服务消息中心设计" class="header-anchor">#</a> 主服务消息中心设计</h4> <p>一些异步任务和操作，比如：文件异步下载、开启子进程等，可以放到<strong>消息中心</strong>这个模块，主要是为了降低耦合度，解耦控制器层。</p> <p>借助 <code>inversify</code> 和 <code>EventEmitter</code>。</p> <ul><li><p>inversify</p> <blockquote><p>InversityJS 是一个 IoC 框架。IoC ( Inversion of Control ) 包括依赖注入 ( Dependency Injection ) 和依赖查询( Dependency Lookup )。相比于类继承的方式，控制反转解耦了父类和子类的联系。</p></blockquote></li> <li><p>EventEmitter</p> <blockquote><p>Node.js 的内置核心模块，本质上就是观察者模式的实现。这里只用了 emit、on 这两个 API，通过 emit 注册一个事件名并传入参数，然后 on 监听这个事件名并执行回掉函数。</p></blockquote></li></ul> <p>初始化容器</p> <p><img src="https://www.zoo.team/images/upload/upload_fba59a97350b7a195ee8116c03f39a34.png" alt="container.png"></p> <p>初始化消息中心插件，并绑定到容器</p> <p><img src="https://www.zoo.team/images/upload/upload_b65263c636e6c64a8bd403565e2b9f9a.png" alt="initPlugins.png"></p> <p><strong>ExecNodeFscrawler</strong> 类功能，主要是监听 <strong>syncES</strong> 事件，通过 <strong>spawn</strong> 开启子进程，执行脚手架命令</p> <p><img src="https://www.zoo.team/images/upload/upload_d6698a1c81a4ccc4264bf823b20c6abe.png" alt="ExecNodeFscrawler2.png"></p> <p>控制器层，依赖注入该<strong>消息中心</strong>插件，触发 <strong>syncES</strong> 事件</p> <p><img src="https://www.zoo.team/images/upload/upload_2939321dcee73e73ea6647b6da5bf6d5.png" alt="ExecNodeFscrawler3.png"></p> <h4 id="上千个项目文件如何导入到-es"><a href="#上千个项目文件如何导入到-es" class="header-anchor">#</a> 上千个项目文件如何导入到 ES？</h4> <p><code>bulk</code> 批量导入数据，批量导入可以合并多个操作，如：Index（创建）、Update（更新）、Delete（删除）。</p> <p>Bulk API 如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_0182537f86cde4cb349936084ad40dc8.png" alt="bulk API.png"></p> <p><code>node-fscrawler</code> 脚手架，会项目的所有文件生成一个 JSON 文件，然后调用 client.bulk 方法，将数据一次性导入到 ES。</p> <p>JSON 文件数据格式如下：</p> <p><img src="https://www.zoo.team/images/upload/upload_c49ad6e5b0ef4efa11c9980dc188f66b.png" alt="JSON.png"></p> <h2 id="未来-展望"><a href="#未来-展望" class="header-anchor">#</a> 未来，展望</h2> <p>“千寻”，设计初心是为了提高代码全局检索效率，降低人力成本。未来，“千寻”还会进一步提升检索命中率，支持精确搜索，实现项目文件实时同步至 ES 等等。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/27/2022, 9:04:59 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tools/位运算.html" class="prev">
        JS中运算符
      </a></span> <span class="next"><a href="/tools/如何实现高性能的在线 PDF 预览.html">
        如何实现高性能的在线 PDF 预览
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.6df8e219.js" defer></script><script src="/assets/js/2.e21ead49.js" defer></script><script src="/assets/js/140.ce3a69fc.js" defer></script>
  </body>
</html>
