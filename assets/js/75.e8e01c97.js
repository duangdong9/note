(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{490:function(e,t,n){"use strict";n.r(t);var s=n(18),l=Object(s.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"如何使用js实现一个发布订阅器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用js实现一个发布订阅器"}},[e._v("#")]),e._v(" 如何使用JS实现一个发布订阅器？")]),e._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/XgY_9ZDxy78KzS3RtDS8aw",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://mp.weixin.qq.com/s/XgY_9ZDxy78KzS3RtDS8aw"),n("OutboundLink")],1)])]),e._v(" "),n("p",[e._v("使用 JS 实现一个发布订阅器，"),n("code",[e._v("Event")]),e._v("，示例如下:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const e = new Event()\n\ne.on('click', x => console.log(x.id))\n\ne.once('click', x => console.log(id))\n\n//=> 3\ne.emit('click', { id: 3 })\n\n//=> 4\ne.emit('click', { id: 4 })\n")])])]),n("p",[e._v("API 如下：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("class Event {\n  emit (type, ...args) {\n  }\n\n  on (type, listener) {\n  }\n\n  once (type, listener) {\n  }\n\n  off (type, listener) {\n  }\n}\n")])])]),n("hr"),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("一个简单的订阅发布模式实现如下，主要有两个核心 API")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("emit")]),e._v(": 发布一个事件")]),e._v(" "),n("li",[n("code",[e._v("on")]),e._v(": 监听一个事件")]),e._v(" "),n("li",[n("code",[e._v("off")]),e._v(": 取消一个事件监听")])]),e._v(" "),n("p",[e._v("实现该模式，使用一个 events 维护发布的事件：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const events = {\n  click: [{\n    once: true,\n    listener: callback,\n  }, {\n    listener: callback\n  }]\n}\n")])])]),n("p",[e._v("具体实现代码如下所示")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("class Event {\n  events = {}\n \n  emit (type, ...args) {\n    const listeners = this.events[type]\n    for (const listener of listeners) {\n      listener.listener(...args)\n      if (listener.once) {\n        this.off(type, listener.listener)\n      }\n    }\n  }\n\n  on (type, listener) {\n    this.events[type] = this.events[type] || []\n    this.events[type].push({ listener })\n  }\n\n  once (type, listener) {\n    this.events[type] = this.events[type] || []\n    this.events[type].push({ listener, once: true })\n  }\n\n  off (type, listener) {\n    this.events[type] = this.events[type] || []\n    this.events[type] = this.events[type].filter(listener => listener.listener !== listener)\n  }\n}\n")])])])])}),[],!1,null,null,null);t.default=l.exports}}]);